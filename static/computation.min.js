function plotBarChart(e,t){var n={top:20,right:20,bottom:50,left:80};var r=820-n.left-n.right;var i=400-n.top-n.bottom;var s=d3.format(".1%");var o=d3.scale.ordinal().rangeRoundBands([0,r],.1).domain(e);var u=d3.scale.linear().range([i,0]).domain([0,d3.max(t)]);var a=d3.svg.axis().scale(o).tickValues(o.domain().filter(function(e,t){return!(t%2)})).orient("bottom");var f=d3.svg.axis().scale(u).orient("left").tickFormat(s);var l=d3.select("#TpDiv").append("svg").attr("class","chart").attr("width",r+n.left+n.right).attr("height",i+n.top+n.bottom).append("g").attr("transform","translate("+n.left+","+n.top+")");l.append("g").attr("class","x axis").attr("transform","translate(0,"+i+")").call(a).append("text").attr("dy","2.1em").attr("x",350).attr("text-anchor","middle").text("Tp (sec)");l.append("g").attr("class","y axis").call(f).append("text").attr("transform","rotate(-90)").attr("y",-60).attr("x",-150).style("text-anchor","middle").text("Percentage contribution");l.selectAll("bar").data(t).enter().append("rect").attr("class","bar").attr("x",function(t,n){return o(e[n])}).attr("width",o.rangeBand()).attr("y",function(e){return u(e)}).attr("height",function(e){return i-u(e)})}function validateForm(e){validation=true;var t=0;var n=0;if(parseFloat(e["latitude"])){if($("#latNumError").is(":visible")){$("#latNumError").hide()}t=parseFloat(e["latitude"])}else{validation=false;$("#latNumError").show()}if(parseFloat(e["longitude"])){if($("#lonNumError").is(":visible")){$("#lonNumError").hide()}n=parseFloat(e["longitude"])}else{validation=false;$("#lonNumError").show()}if(!validation){return false}if(t<24.6||t>49.5){validation=false;$("#latRangeError").show()}else{if($("#latRangeError").is(":visible")){$("#latRangeError").hide()}}if(n<-124.9||n>-66.9){validation=false;$("#lonRangeError").show()}else{if($("#lonRangeError").is(":visible")){$("#lonRangeError").hide()}}return validation}function displayResult(e){if(e["error"]==-1){$("#USGSerror").show();$("#loadingDiv").hide();$("#submit").attr("disabled",false)}else{$("#TpDiv").html("<h3> Distribution of Pulse periods causing the hazard exceedance </h3>");plotBarChart(e["Tps"],e["TpDist"]);$("#loadingDiv").hide(100);$("#PpulsePercent").html(e["percent"]);$("#PpulseYears").html(e["years"]);$("#PpulseSaLevel").html(e["saLevel"]);$("#ppulseResult").html(e["ppulse"].toFixed(3));$("#ppulseDiv").show(500);$("#TpDiv").show(500);$("#dldLink").attr("href",e["dldLink"]);$("#downloadDiv").show(500);$("#submit").attr("disabled",false)}}$(document).ready(function(){$("#TpDiv").hide();$("#ppulseDiv").hide();$("#loadingDiv").hide();$("#downloadDiv").hide();$("#latNumError").hide();$("#lonNumError").hide();$("#latRangeError").hide();$("#lonRangeError").hide();$("#USGSerror").hide();$("#submit").click(function(){formData={analysis_name:$("#analysis_name").val(),latitude:$("#latitude").val(),longitude:$("#longitude").val(),percent:$("#percent").val(),years:$("#years").val(),period:$("#period").val(),vs30:$("#vs30").val()};if($("#USGSerror").is(":visible")){$("#USGSerror").hide()}if(validateForm(formData)){$("#submit").attr("disabled",true);$.post($SCRIPT_ROOT+"/approx_deagg",formData,displayResult,"json");if($("#TpDiv").is(":visible")){$("#TpDiv").hide(300)}if($("#ppulseDiv").is(":visible")){$("#ppulseDiv").hide(300)}if($("#downloadDiv").is(":visible")){$("#downloadDiv").hide(300)}$("#loadingDiv").show(750);$("#TpDiv").html("")}})})
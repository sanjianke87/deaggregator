function plotBarChart(Tps,Probs){	var margin = {top: 20, right:20, bottom: 50, left:80}	var width = 820 - margin.left - margin.right;	var height = 400 - margin.top - margin.bottom;		var formatPercent = d3.format(".1%");		var x = d3.scale.ordinal().rangeRoundBands([0, width], .1).domain(Tps);	var y = d3.scale.linear().range([height, 0]).domain([0,d3.max(Probs)]);		var xAxis = d3.svg.axis().scale(x).tickValues(x.domain().filter(function(d,i){return !(i%2);})).orient("bottom");		var yAxis = d3.svg.axis().scale(y).orient("left").tickFormat(formatPercent);		var svg = d3.select("#TpDiv").append("svg").attr("class","chart").attr("width",width + margin.left + margin.right).attr("height",height + margin.top + margin.bottom).append("g").attr("transform","translate("+ margin.left + "," + margin.top + ")");		svg.append("g").attr("class","x axis").attr("transform","translate(0," + height + ")").call(xAxis)						.append("text")						.attr("dy","2.1em")						.attr("x",350)						.attr("text-anchor","middle")						.text("Tp (sec)");	svg.append("g").attr("class","y axis").call(yAxis)						.append("text")						.attr("transform", "rotate(-90)")						.attr("y",-60)						.attr("x",-150)						.style("text-anchor","middle")						.text("Percentage contribution");			svg.selectAll("bar").data(Probs).enter().append("rect").attr("class","bar")		.attr("x", function(d,i) {return x(Tps[i]);})		.attr("width",x.rangeBand())		.attr("y",function(d) {return y(d);})		.attr("height",function(d){return height - y(d) ;});}function validateForm(data){	//check if the latitude and longitudes are numbers	validation = true;	var lat = 0;	var lon = 0;	if(parseFloat(data['latitude'])){		if($("#latNumError").is(":visible")){			$("#latNumError").hide();		}		lat = parseFloat(data['latitude']);	}else{		validation = false;		$('#latNumError').show()	}	if(parseFloat(data['longitude'])){		if($("#lonNumError").is(":visible")){			$("#lonNumError").hide();		}		lon = parseFloat(data['longitude']);	}else{		validation = false;		$('#lonNumError').show()	}		if(!validation){		return false;	}		//check lat long range	if(lat < 24.6 || lat > 49.5){		validation = false;		$('#latRangeError').show();	}else{		if($("#latRangeError").is(":visible")){			$("#latRangeError").hide();		}	}		if(lon < -124.9 || lon > -66.9){		validation = false;		$('#lonRangeError').show();	}else{		if($("#lonRangeError").is(":visible")){			$("#lonRangeError").hide();		}	}		return validation;}function displayResult(data){	// check for USGS error	if(data["error"] == -1){		$("#USGSerror").show();		$("#loadingDiv").hide();		$('#submit').attr('disabled',false);	}else{		$('#TpDiv').html("<h3> Distribution of Pulse periods causing the hazard exceedance </h3>");		plotBarChart(data['Tps'],data['TpDist']);		$('#loadingDiv').hide(100);		$('#PpulsePercent').html(data['percent']);		$('#PpulseYears').html(data['years']);		$('#PpulseSaLevel').html(data['saLevel']);		$('#ppulseResult').html(data['ppulse'].toFixed(3));		$('#ppulseDiv').show(500);		$('#TpDiv').show(500);		$('#dldLink').attr('href',data['dldLink']);		$('#downloadDiv').show(500);		$('#submit').attr('disabled',false);	}}$(document).ready(function(){	$('#TpDiv').hide();	$('#ppulseDiv').hide();	$('#loadingDiv').hide();	$('#downloadDiv').hide();	$('#latNumError').hide();	$('#lonNumError').hide();	$('#latRangeError').hide();	$('#lonRangeError').hide();	$('#USGSerror').hide();	$('#submit').click(function(){		formData = {'analysis_name':$('#analysis_name').val() , 'latitude':$('#latitude').val() , 'longitude':$('#longitude').val() , 'percent':$('#percent').val() , 'years':$('#years').val() , 'period':$('#period').val() , 'vs30':$('#vs30').val()}		if($("#USGSerror").is(":visible")){			$("#USGSerror").hide();		}		if(validateForm(formData)){			$('#submit').attr('disabled',true);						$.post($SCRIPT_ROOT + '/approx_deagg',formData,displayResult,'json');						if($('#TpDiv').is(":visible")){				$('#TpDiv').hide(300);			}					if($('#ppulseDiv').is(":visible")){				$('#ppulseDiv').hide(300);			}					if($('#downloadDiv').is(":visible")){				$('#downloadDiv').hide(300);			}					$('#loadingDiv').show(750);			$('#TpDiv').html('');		}	});});